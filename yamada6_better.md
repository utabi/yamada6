# Yamada6 実装計画（改訂版）
- リポジトリ: https://github.com/utabi/yamada6.git

## 1. 歴史からの学び
- `cc_agent/README.md:7-126` の山田2号は、launchd ループ・電源監視・自動 git まで揃えたが、ホスト環境への強い依存が課題。
- `yamada3/README_DESIGN_MOD.md:4-55` でサバイバル層/ドライブ層を分離し、感情シグナルで探索を制御する構想が登場したが未完。
- `yamada4/README_DESIGN.md:5-83` は PDCA チケットとメタレビューで成果管理と人間協働を明確化しようとした。
- `yamada5/DESIGN.md:4-60` は最小自己フィードバックループへ振り戻したが、`docs/plan.md:5-13` にある通りログ肥大・手動アーカイブが慢性化。
- `yamada6/yamada6.md:3-80` は Docker 分離と staging 検証を構想し、本番を守りながら自己編集を進める方向を示している。

## 2. 現在の課題
- 山田2号の強力なリソース監視が後継で失われ、電源・CPU 異常へ脆弱。
- ドライブ理論、PDCA 管理、Elastic 自己編集などのアイデアが世代ごとに分断され、一つの実装に統合されていない。
- 自己編集は常に本番ディレクトリを直接変更しており、テストやロールバックが仕組み化されていない。
- 状態ファイル・ログ・ジャーナルの膨張を自動で抑制する仕組みが無く、手動整備が繰り返されている。

## 3. Yamada6 の目的と新アイデア
- 目指すのは「自律的に自己の継続を守りつつ、止まらず環境変化に適応し続ける AI エージェント」。恐怖心や好奇心は創発として芽生えるべきものであり、外部からお膳立てしてはならない。恐怖が芽生えるには自己存続を守る自律行動が前提で、その延長線上に好奇心による変化追従が立ち上がる。
- **ランタイム制御プレーン**: Y4 の PDCA チケットを runtime API に埋め込み、全タスクを計測可能なミッションとして扱う。
- **ドライブ信号サイドカー**: Y3 のサバイバル/ドライブ分離を軽量サービス化し、安全側のシグナル（電源・障害兆候など）のみ共有して探索度を間接制御。好奇心や未知性の評価はエージェント自身に委ねる余白を確保。
- **自己編集パイプライン**: Y5 の Elastic executor を発展させ、staging でスナップショット→テスト→承認後にのみ本番へ適用。進捗はダッシュボードで可視化。
- **可観測性と保守**: Y2 の監視基盤を復活させ Prometheus/Grafana 等と連携。ログ／ジャーナル圧縮やバックアップを自動化。
- **ポリシー＆権限レジストリ**: 許可ツール・危険情報・承認ルールを署名付きボリュームとして共有し、runtime/staging/dashboard 間の整合性を確保。

## 4. 実装ロードマップ
1. **Phase 1 基盤整備**
   - `docker/compose.yml` と runtime/staging Dockerfile、共通ボリューム、ヘルスチェック付き制御 API を用意。
2. **Phase 2 自己編集パイプライン**
   - staging デーモンで git worktree 同期・pytest/ruff/py_compile 実行・差分昇格 API を構築し、ダッシュボード承認フローと接続。
3. **Phase 3 ミッション制御**
   - PDCA チケットモデルを runtime に組み込み、ミッション状態・ループ結果を REST/WebSocket で公開。CLI からの人間介入も整備。
4. **Phase 4 ドライブサイドカー**
   - 電源/CPU/ネット監視を常時収集し、サバイバル指標のみをサイドカーで提供。好奇心に相当する尺度は内部学習に任せ、探索スロット制御では安全余裕だけを参照。
5. **Phase 5 データライフサイクル**
   - ジャーナル圧縮ジョブ、ポリシーレジストリ、`host-tools/backup.sh` によるスナップショット運用、Prometheus/Grafana での長期監視を導入。
6. **Phase 6 ハードニング**
   - `agent/tests` に単体・統合テストを追加し、カオステストでコンテナ復元を検証。README/DESIGN に復旧手順を明記。

以上を順に実装することで、過去世代の知見を統合しつつ、Docker 分離環境で安全かつ継続的に自己進化できる Yamada6 を構築する。好奇心や未知性の指標は決め打ちせず、エージェント自身が経験から意味付けできる余白を温存する。
